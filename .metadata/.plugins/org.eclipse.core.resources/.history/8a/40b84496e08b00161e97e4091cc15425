package qwq;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import com.opensymphony.xwork2.ActionContext;
import com.opensymphony.xwork2.ActionSupport;

public class SearchBook extends ActionSupport {

	private String authorsName;
	private String AuthorID;
	private String Name;
	private String Title;
	
	public String getAuthorsName() {
		return authorsName;
	}
	
	public void setAuthorsName(String authorsName) {
		this.authorsName = authorsName;
	}
	
	public String getName() {
		return Name;
	}
	
	public void setName(String Name) {
		this.Name = Name;
	}

	public String getAuthorID() {
		return AuthorID;
	}
	
	public void setAuthorID(String AuthorID) {
		this.AuthorID = AuthorID;
	}
	public String execute() throws Exception {
		String ret = ERROR;
//		String ret = SUCCESS;
		String URL = "jdbc:mysql://localhost/BookDB";
		Class.forName("com.mysql.jdbc.Driver");
		Connection conn = DriverManager.getConnection(URL, "root", "12345678");
		String sql = "SELECT AuthorID FROM Author WHERE";
		sql += " Name = ?";
		PreparedStatement ps = conn.prepareStatement(sql);
		ps.setString(1, authorsName);
		ResultSet rs = ps.executeQuery();
		
		ActionContext ctx = ActionContext.getContext();
		ctx.getSession().put("user", getAuthorsName());	
		ctx.put("tip", "对不起，您查询的作者不存在");
		Title = "123123";
		while(rs.next()) {
			AuthorID = rs.getString(1);
			String sql2 = "SELECT Title FROM Book WHERE";
			sql2 += " AuthorID = ?";
			PreparedStatement ps2 = conn.prepareStatement(sql2);
			ps2.setString(1, AuthorID);
			ResultSet rs2 = ps2.executeQuery();
			while(rs2.next()) {
				Title = rs2.getString(1);
				ctx.put("tip", "您查询的图书信息如下");
				ret = SUCCESS;
			}

		}
	
		if (ret.equals(SUCCESS)) {
			//ctx.put("authorsName", "xxxxxxx");
			ctx.put("bookISBN", Name);
			ctx.put("bookPrice", "$12.3");
//			ctx.put("Title", Title);
		}
		
		if(conn != null) {	
			conn.close();
		}
		return ret;
	}
}
